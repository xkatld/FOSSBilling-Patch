{% if order.status == 'active' %}
{% set vm = client.servicelxdapi_vm_info({"order_id": order.id}) %}

<div id="lxdapi-panel-content" style="display:none;">
    <div class="card mb-3">
        <div class="card-body py-2">
            <a href="{{ vm.panel_url }}" target="_blank" class="btn btn-primary">
                <i class="fa fa-external-link-alt me-1"></i> 进入面板
            </a>
            <span class="ms-3 text-muted">点击按钮将在新窗口打开容器管理面板</span>
        </div>
    </div>
    {% if vm.iframe_url %}
    <div class="card">
        <div class="card-body p-0">
            <iframe src="{{ vm.iframe_url }}" style="width:100%; height:80vh; border:none; display:block;"></iframe>
        </div>
    </div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var serviceCard = document.querySelector('.card-header h1')?.closest('.card');
    var panelContent = document.getElementById('lxdapi-panel-content');
    
    if (serviceCard && panelContent) {
        var tabsHtml = `
            <ul class="nav nav-tabs mb-3" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="tab-details" data-bs-toggle="tab" data-bs-target="#pane-details" type="button" role="tab">服务详情</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="tab-panel" data-bs-toggle="tab" data-bs-target="#pane-panel" type="button" role="tab">管理面板</button>
                </li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane fade show active" id="pane-details" role="tabpanel"></div>
                <div class="tab-pane fade" id="pane-panel" role="tabpanel"></div>
            </div>
        `;
        
        var tabsContainer = document.createElement('div');
        tabsContainer.innerHTML = tabsHtml;
        serviceCard.parentNode.insertBefore(tabsContainer, serviceCard);
        
        document.getElementById('pane-details').appendChild(serviceCard);
        document.getElementById('pane-panel').innerHTML = panelContent.innerHTML;
        panelContent.remove();
    }
});
</script>

{% endif %}
